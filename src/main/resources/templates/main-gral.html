<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout('MetaMapa', ~{::link}, ~{::section})}">
<head>
    <link th:href="@{/css/styles-main.css}" rel="stylesheet">
</head>
<body>
    <!-- Main -->
    <section class="d-flex justify-content-center flex-column align-items-center" style="padding-top: 200px" th:with="isContrib=${#bools.isTrue(session.isContribuyente)}, isAdmin=${#bools.isTrue(session.isAdmin)}">>
        <!-- Pruebita para chequear si se asigna o no un rol -->
<!--        <div style="color:#6b8397;font-size:.9rem;margin-bottom:8px;">-->
<!--            isContrib: <b th:text="${isContribuyente}">false</b> | isAdmin: <b th:text="${isAdmin}">false</b>-->
<!--        </div>-->

        <h2 class="title-main text-md-center">¿Qué querés hacer?</h2>

        <a th:href="@{/hechos/nav-hechos}"><button class="btn btn-sin-login btn-lg mb-3" aria-label="Ir a la sección de Navegar Hechos">Navegar Hechos</button></a>
        <a th:href="@{/colecciones}"><button class="btn btn-sin-login btn-lg mb-3" aria-label="Ver las Colecciones">Ver Colecciones</button></a>
        <a th:href="@{/hechos/subir-hecho}"><button class="btn btn-sin-login btn-lg mb-3" aria-label="Subir un Nuevo Hecho al sistema">Subir un Hecho</button></a>

        <!-- Solo visible para contribuyentes (registrados) AUN NO LO PUDE HACER FUNCIONAR -->
<!--        <th:block th:if="${#httpSession.getAttribute('isContribuyente')}">-->
        <th:block th:if="${isContrib}">
            <a th:href="@{/hechos/mis-hechos}"><button class="btn btn-sin-login btn-lg mb-3" aria-label="Ver Hechos que subí al sistema">Ver mis Hechos</button></a>
        </th:block>
        <!--        <a href="hecho-completo.html"><button id="btn-solicitar-eliminacion" class="btn btn-sin-login btn-lg mb-3" aria-label="Solicitar eliminacion de un hecho">Solicitar Eliminación</button></a>-->

        <a th:href="@{/iniciar-sesion}"><button class="btn btn-back btn-lg mb-3" aria-label="Volver a la página anterior">Volver atrás</button></a>
    </section>

    <!-- Par que funcione el collapse -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const auth = JSON.parse(localStorage.getItem("mm_auth") || sessionStorage.getItem("mm_auth"));
          const btn = document.getElementById("btn-solicitar-eliminacion");
          console.log("auth:", auth); //para ver q es lo q toma de datos auth
          if (btn) {
            console.log("btn encontrado");
            if (!auth || auth.role !== "contribuyente") {
              btn.style.display = "none";
              console.log("Botón ocultado");
            }
          } else {
            console.log("btn NO encontrado");
          }
        });
    </script>

</body>
</html>
